---
import Layout from "../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
---

<Layout
  title="Solicitar Demo - TurnApp Sistema de Gestión de Turnos"
  description="Agenda una demostración para ver cómo TurnApp puede optimizar la gestión de turnos en tu institución."
>
  <div
    class="min-h-screen bg-gradient-to-b from-payflo-gray/50 to-white py-16 px-4 sm:px-6 lg:px-8"
  >
    <div class="max-w-3xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4">Solicitar Una Demostración</h1>
        <p class="text-xl text-gray-600">
          Descubre cómo TurnApp puede optimizar la gestión de turnos en tu
          institución
        </p>
      </div>

      <!-- Multi-step Form -->
      <div
        class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden"
      >
        <!-- Progress Steps -->
        <div class="flex border-b border-gray-100" id="progress-steps">
          <div
            class="flex-1 p-4 text-center bg-payflo-purple/5 border-r border-gray-100 current-step"
            data-step="1"
          >
            <div class="flex items-center justify-center mb-2">
              <div
                class="step-circle w-8 h-8 min-w-[2rem] min-h-[2rem] rounded-full bg-payflo-purple text-white flex items-center justify-center text-sm font-medium leading-none"
              >
                <span class="block leading-none align-middle">1</span>
              </div>
            </div>
            <span class="text-sm font-medium"
              >Información de la Institución</span
            >
          </div>
          <div class="flex-1 p-4 text-center" data-step="2">
            <div class="flex items-center justify-center mb-2">
              <div
                class="step-circle w-8 h-8 min-w-[2rem] min-h-[2rem] rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-sm font-medium leading-none"
              >
                <span class="block leading-none align-middle">2</span>
              </div>
            </div>
            <span class="text-sm font-medium">Datos de Contacto</span>
          </div>
        </div>

        <!-- Form Steps -->
        <form id="demo-form" class="p-8">
          <!-- Step 1: Información de la Institución -->
          <div class="step-content" id="step-1">
            <div class="space-y-6">
              <div>
                <label
                  for="company"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Nombre de la Institución *
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Nombre de su institución"
                />
              </div>

              <div>
                <label
                  for="website"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Sitio Web de la Institución
                </label>
                <input
                  type="url"
                  id="website"
                  name="website"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="https://"
                />
              </div>

              <div>
                <label
                  for="company-size"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Tamaño de la Institución *
                </label>
                <select
                  id="company-size"
                  name="company-size"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                >
                  <option value="">Seleccione el tamaño</option>
                  <option value="1-10">1-10 empleados</option>
                  <option value="11-50">11-50 empleados</option>
                  <option value="51-200">51-200 empleados</option>
                  <option value="201-500">201-500 empleados</option>
                  <option value="501+">501+ empleados</option>
                </select>
              </div>

              <div>
                <label
                  for="industry"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Tipo de Institución *
                </label>
                <select
                  id="industry"
                  name="industry"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                >
                  <option value="">Seleccione el tipo</option>
                  <option value="healthcare">Centro de Salud/Hospital</option>
                  <option value="government">Institución Gubernamental</option>
                  <option value="education">Institución Educativa</option>
                  <option value="financial">Institución Financiera</option>
                  <option value="retail">Comercio/Minorista</option>
                  <option value="other">Otro</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Step 2: Datos de Contacto -->
          <div class="step-content hidden" id="step-2">
            <div class="space-y-6">
              <div class="grid grid-cols-2 gap-6">
                <div>
                  <label
                    for="first-name"
                    class="block text-sm font-medium text-gray-700 mb-1"
                  >
                    Nombre *
                  </label>
                  <input
                    type="text"
                    id="first-name"
                    name="first-name"
                    required
                    class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                    placeholder="Tu nombre"
                  />
                </div>
                <div>
                  <label
                    for="last-name"
                    class="block text-sm font-medium text-gray-700 mb-1"
                  >
                    Apellido *
                  </label>
                  <input
                    type="text"
                    id="last-name"
                    name="last-name"
                    required
                    class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                    placeholder="Tu apellido"
                  />
                </div>
              </div>

              <div>
                <label
                  for="work-email"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Correo Electrónico Laboral *
                </label>
                <input
                  type="email"
                  id="work-email"
                  name="work-email"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="usted@institucion.com"
                />
              </div>

              <div>
                <label
                  for="job-title"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Cargo *
                </label>
                <input
                  type="text"
                  id="job-title"
                  name="job-title"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Tu cargo en la institución"
                />
              </div>

              <div>
                <label
                  for="phone"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Número de Teléfono
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Opcional"
                />
              </div>

              <div>
                <label
                  for="message"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Información Adicional
                </label>
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Cuéntanos sobre tus necesidades específicas o cualquier pregunta que tengas..."
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Form Navigation -->
          <div class="mt-8 flex justify-between">
            <button
              type="button"
              id="prev-step"
              class="hidden px-6 py-3 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Anterior
            </button>
            <button
              type="button"
              id="next-step"
              class="ml-auto px-6 py-3 bg-payflo-purple text-white rounded-lg hover:bg-payflo-purple/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Siguiente
            </button>
            <button
              type="submit"
              id="submit-form"
              class="hidden ml-auto px-6 py-3 bg-payflo-purple text-white rounded-lg hover:bg-payflo-purple/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Solicitar Demo
            </button>
          </div>
        </form>
      </div>

      <!-- Trust Badges -->
      <div class="mt-12 text-center">
        <p class="text-sm text-gray-600 mb-4">
          Confiado por instituciones líderes
        </p>
        <div class="flex justify-center space-x-8">
          <Icon name="ph:shield-check-duotone" class="h-6 w-6 text-gray-400" />
          <Icon name="ph:lock-key-duotone" class="h-6 w-6 text-gray-400" />
          <Icon name="ph:certificate-duotone" class="h-6 w-6 text-gray-400" />
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Clase personalizada para asegurar círculos perfectos */
  .step-circle {
    width: 2rem !important;
    height: 2rem !important;
    min-width: 2rem !important;
    min-height: 2rem !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
  }

  .step-circle span {
    display: block;
    line-height: 1;
    margin: 0;
    padding: 0;
  }
</style>

<script>
  // ===== Multi-step Demo Form (2 steps) =====
  const initDemoForm = () => {
    const form = document.getElementById("demo-form");
    if (!form) return;

    const steps = document.querySelectorAll(".step-content");
    const progressSteps = document.querySelectorAll("#progress-steps > div");
    const prevButton = document.getElementById("prev-step");
    const nextButton = document.getElementById("next-step");
    const submitButton = document.getElementById("submit-form");

    let currentStep = 1;

    function updateSteps() {
      steps.forEach((step, index) => {
        step.classList.toggle("hidden", index + 1 !== currentStep);
      });

      progressSteps.forEach((step, index) => {
        const stepCircle = step.querySelector(".step-circle");
        if (stepCircle) {
          const isActive = index + 1 <= currentStep;
          step.classList.toggle("bg-payflo-purple/5", isActive);
          if (isActive) {
            stepCircle.classList.add("bg-payflo-purple", "text-white");
            stepCircle.classList.remove("bg-gray-200", "text-gray-600");
          } else {
            stepCircle.classList.add("bg-gray-200", "text-gray-600");
            stepCircle.classList.remove("bg-payflo-purple", "text-white");
          }
        }
      });

      if (prevButton)
        prevButton.style.display = currentStep === 1 ? "none" : "block";
      if (nextButton)
        nextButton.style.display = currentStep === 2 ? "none" : "block";
      if (submitButton)
        submitButton.style.display = currentStep === 2 ? "block" : "none";
    }

    function validateStep(step) {
      if (step === 1) {
        const company = document.getElementById("company")?.value;
        const companySize = document.getElementById("company-size")?.value;
        const industry = document.getElementById("industry")?.value;

        if (!company || !companySize || !industry) {
          const missingFields = [];
          if (!company) missingFields.push("Nombre de la Institución");
          if (!companySize) missingFields.push("Tamaño de la Institución");
          if (!industry) missingFields.push("Tipo de Institución");

          alert(
            `Por favor complete los siguientes campos obligatorios:\n${missingFields.join("\n")}`
          );
          return false;
        }

        return true;
      }

      if (step === 2) {
        const firstName = document.getElementById("first-name")?.value;
        const lastName = document.getElementById("last-name")?.value;
        const email = document.getElementById("work-email")?.value;
        const jobTitle = document.getElementById("job-title")?.value;

        if (!firstName || !lastName || !email || !jobTitle) {
          const missingFields = [];
          if (!firstName) missingFields.push("Nombre");
          if (!lastName) missingFields.push("Apellido");
          if (!email) missingFields.push("Correo Electrónico Laboral");
          if (!jobTitle) missingFields.push("Cargo");

          alert(
            `Por favor complete los siguientes campos obligatorios:\n${missingFields.join("\n")}`
          );
          return false;
        }

        // Validar formato de email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert("Por favor ingrese una dirección de correo electrónico válida");
          return false;
        }

        return true;
      }

      return true;
    }

    // Event Listeners
    if (prevButton) {
      prevButton.addEventListener("click", () => {
        if (currentStep > 1) {
          currentStep--;
          updateSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
    }

    if (nextButton) {
      nextButton.addEventListener("click", () => {
        if (validateStep(currentStep)) {
          currentStep++;
          updateSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
    }

    if (form) {
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (validateStep(currentStep)) {
          // Aquí normalmente enviarías los datos del formulario a tu backend
          alert(
            "¡Gracias por solicitar una demostración! Nos pondremos en contacto contigo pronto."
          );
          form.reset();
          currentStep = 1;
          updateSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
    }

    // Initial update
    updateSteps();
  };

  // Inicializar cuando el DOM esté listo
  document.addEventListener("DOMContentLoaded", initDemoForm);
</script>
